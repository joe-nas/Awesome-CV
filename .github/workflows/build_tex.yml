name: Receive Dispatch

on:
  repository_dispatch:
    types: [data-changed]

jobs:
  setup-build:
    runs-on: ubuntu-latest
    steps:
      # - name: Checkout joe-nas/Awesome-CV
      #   uses: actions/checkout@v4 # github or community actions/ @ is not limited to releases but could be a branch or a commit or tag
      #   with:
      #     token: ${{ secrets.PAT }} # secrets github context / besides secrets there more contexts: https://docs.github.com/en/actions/learn-github-actions/contexts
      #     repository: joe-nas/Awesome-CV
      #     path: Awesome-CV

      - name: Checkout posquit0/Awesome-CV
        uses: actions/checkout@v4 # github or community actions/ @ is not limited to releases but could be a branch or a commit or tag
        with:
          # token: ${{ secrets.PAT }} # secrets github context / besides secrets there more contexts: https://docs.github.com/en/actions/learn-github-actions/contexts
          repository: posquit0/Awesome-CV
          path: Awesome-CV
          

      - name: Checkout joe-nas/cv_automation
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT }}
          repository: joe-nas/cv_automation
          path: cv_automation

      # - name: Set up Python
      #   uses: actions/setup-python@v5
      #   with:
      #     python-version: 3.12.2
      #     cache: pip
  
      - name: Install dependencies
        run: pip install jinja2
      

      # - name: Run json_to_tex.py
        # run: |
          # echo ðŸŽƒðŸŽƒðŸŽƒðŸŽƒ
          # # cp -r cv_automation/data Awesome-CV
          # cd Awesome-CV
          # mkdir output
          # # python json_to_tex.py
          # echo ðŸŽƒðŸŽƒexecuted json_to_texðŸŽƒðŸŽƒabout:blank#blocked
          # # mv output/*.tex examples/cv
          # ls -la examples
          # chmod -R 777 .
          # docker run --rm --user $(id -u):$(id -g) -i -w "/doc" -v "$PWD":/doc thomasweise/texlive make
          # echo '${{ toJSON(github.event) }}'

      - name: build CV using docker image
        run: |
          cd Awesome-CV
          docker run --rm --user $(id -u):$(id -g) -i -w "/doc" -v "$PWD":/doc thomasweise/texlive make
          cp examples/cv.pdf ../../cv.pdf

      - name: Create Test File
        run: echo ${{ github.event.client_payload.ref_name }} > ${{ github.event.client_payload.ref_name }}.txt

      - name: Upload to Google Drive
        uses: adityak74/google-drive-upload-git-action@main
        with:
          # filename: ${{ github.event.client_payload.ref_name }}.txt
          filename: cv.pdf
          credentials: ${{ secrets.GOOGLE_DRIVE }}
          folderId: ${{ secrets.GOOGLE_DRIVE_FOLDER_ID }}
          overwrite: true